<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Compassion Conflict Worksheet</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        .subtitle:last-of-type {
            margin-bottom: 20px;
        }
        
        .attribution {
            text-align: center;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        
        .attribution a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }
        
        .attribution a:hover {
            text-decoration: underline;
        }
        
        .notes-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .notes-section h3 {
            margin-top: 0;
            color: #333;
            font-size: 1.2em;
        }
        
        .notes-section textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
            transition: border-color 0.2s;
        }
        
        .notes-section textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .section-header {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .section-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.3em;
        }
        
        .worksheet-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .category {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .category h2 {
            margin-top: 0;
            padding: 12px;
            border-radius: 8px;
            color: white;
            font-size: 1.1em;
        }
        
        .physiological h2 { background: #e74c3c; }
        .nervous-system h2 { background: #e67e22; }
        .emotional h2 { background: #f1c40f; }
        .distortions h2 { background: #e91e63; }
        .safety h2 { background: #9b59b6; }
        .social h2 { background: #3498db; }
        .relational h2 { background: #1abc9c; }
        .uncertainty h2 { background: #16a085; }
        .needs h2 { background: #27ae60; }
        .recent h2 { background: #2c3e50; }
        .identity h2 { background: #7f8c8d; }
        
        .items {
            list-style: none;
            padding: 0;
            margin: 15px 0 0 0;
        }
        
        .item {
            padding: 10px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            transition: background 0.2s;
        }
        
        .item:hover {
            background: #e9ecef;
        }
        
        .item input[type="checkbox"] {
            margin-top: 3px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .item label {
            cursor: pointer;
            font-size: 0.95em;
            line-height: 1.4;
            flex-grow: 1;
        }
        
        .physiological .item { border-left-color: #e74c3c; }
        .nervous-system .item { border-left-color: #e67e22; }
        .emotional .item { border-left-color: #f1c40f; }
        .safety .item { border-left-color: #9b59b6; }
        .social .item { border-left-color: #3498db; }
        .relational .item { border-left-color: #1abc9c; }
        .uncertainty .item { border-left-color: #16a085; }
        .needs .item { border-left-color: #27ae60; }
        .recent .item { border-left-color: #2c3e50; }
        .identity .item { border-left-color: #7f8c8d; }
        .distortions .item { border-left-color: #e91e63; }
        
        .category-notes {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }
        
        .category-notes label {
            display: block;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .category-notes textarea {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.9em;
            resize: vertical;
            transition: border-color 0.2s;
        }
        
        .category-notes textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .integration {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 30px;
        }
        
        .integration h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
        }
        
        .integration-question {
            margin-bottom: 25px;
        }
        
        .integration-question label {
            display: block;
            padding: 12px;
            background: #e8f4f8;
            border-radius: 8px;
            border-left: 5px solid #3498db;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .integration-question textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95em;
            resize: vertical;
            transition: border-color 0.2s;
        }
        
        .integration-question textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .stats-dashboard {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 30px;
        }
        
        .stats-dashboard h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }
        
        .stat-card h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        
        .top-factors-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .top-factors-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .top-factors-list li:last-child {
            border-bottom: none;
        }
        
        .factor-count {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .category-breakdown {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .category-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-label {
            min-width: 120px;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .bar-container {
            flex-grow: 1;
            height: 24px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }
        
        .bar-percentage {
            color: white;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
        }
        
        .history-item {
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .history-item:hover {
            background: #f8f9fa;
        }
        
        .history-date {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 4px;
        }
        
        .history-summary {
            font-size: 0.9em;
            color: #666;
        }
        
        .data-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            color: #856404;
            font-size: 0.95em;
        }
        
        .data-warning strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .save-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .btn-save {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: #27ae60;
            color: white;
        }
        
        .btn-save:hover {
            background: #229954;
        }
        
        @media print {
            body {
                background: white;
            }
            .actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <h1>Self-Compassion Conflict Worksheet</h1>
    <p class="subtitle">Factors That Affect Self-Regulation in Communication</p>
    <p class="subtitle">For when we go from assertive, compassionate communication ‚Üí indirect, self-preoccupied communication</p>
    <div class="attribution">
        More tools like this: <a href="https://www.tiktok.com/@instageorgious?is_from_webapp=1&sender_device=pc" target="_blank">@instageorgious</a>
    </div>
    
    <div class="notes-section">
        <h3>üìù What happened? Describe the interaction or conflict:</h3>
        <textarea id="context" placeholder="Briefly describe what happened, who was involved, and what made it difficult..."></textarea>
    </div>
    
    <div class="section-header">
        <h3>üî¥ Physiological/Internal Factors</h3>
    </div>
    
    <div class="worksheet-container">
        <div class="category physiological">
            <h2>Basic Physical Needs</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="hunger"><label for="hunger">Hunger or low blood sugar</label></li>
                <li class="item"><input type="checkbox" id="dehydration"><label for="dehydration">Dehydration or thirst</label></li>
                <li class="item"><input type="checkbox" id="eliminate"><label for="eliminate">Need to urinate or defecate</label></li>
                <li class="item"><input type="checkbox" id="fatigue"><label for="fatigue">Fatigue or sleep deprivation</label></li>
                <li class="item"><input type="checkbox" id="pain"><label for="pain">Physical pain (acute or chronic)</label></li>
                <li class="item"><input type="checkbox" id="illness"><label for="illness">Illness or feeling unwell</label></li>
                <li class="item"><input type="checkbox" id="overstim"><label for="overstim">Overstimulation (noise, light, sensory)</label></li>
                <li class="item"><input type="checkbox" id="discomfort"><label for="discomfort">Physical discomfort (temperature, seating, clothing)</label></li>
                <li class="item"><input type="checkbox" id="caffeine"><label for="caffeine">Caffeine excess or withdrawal</label></li>
                <li class="item"><input type="checkbox" id="medication"><label for="medication">Medication effects or withdrawal</label></li>
                <li class="item"><input type="checkbox" id="hormonal"><label for="hormonal">Hormonal fluctuations</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-physiological">Additional notes:</label>
                <textarea id="notes-physiological" placeholder="Any other physical needs or sensations..."></textarea>
            </div>
        </div>
        
        <div class="category nervous-system">
            <h2>Nervous System States</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="hyperarousal"><label for="hyperarousal">Hyperarousal (fight/flight activation)</label></li>
                <li class="item"><input type="checkbox" id="hypoarousal"><label for="hypoarousal">Hypoarousal (shutdown/freeze response)</label></li>
                <li class="item"><input type="checkbox" id="dysregulation"><label for="dysregulation">Dysregulation from past trauma</label></li>
                <li class="item"><input type="checkbox" id="triggers"><label for="triggers">Activation of specific trauma triggers</label></li>
                <li class="item"><input type="checkbox" id="interoceptive"><label for="interoceptive">Interoceptive disconnect (unaware of body signals)</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-nervous">Additional notes:</label>
                <textarea id="notes-nervous" placeholder="Any other observations about your nervous system state..."></textarea>
            </div>
        </div>
        
        <div class="category emotional">
            <h2>Emotional/Mental States</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="overwhelmed"><label for="overwhelmed">Feeling overwhelmed or cognitively overloaded</label></li>
                <li class="item"><input type="checkbox" id="shame"><label for="shame">Shame or embarrassment</label></li>
                <li class="item"><input type="checkbox" id="grief"><label for="grief">Grief or sadness</label></li>
                <li class="item"><input type="checkbox" id="anxiety"><label for="anxiety">Anxiety or worry about something unrelated</label></li>
                <li class="item"><input type="checkbox" id="anger"><label for="anger">Anger or frustration carried from elsewhere</label></li>
                <li class="item"><input type="checkbox" id="loneliness"><label for="loneliness">Loneliness or feeling disconnected</label></li>
                <li class="item"><input type="checkbox" id="selfcrit"><label for="selfcrit">Self-criticism or negative self-talk active</label></li>
                <li class="item"><input type="checkbox" id="rumination"><label for="rumination">Rumination on past events</label></li>
                <li class="item"><input type="checkbox" id="rehearsal"><label for="rehearsal">Mental rehearsal of future conflicts</label></li>
                <li class="item"><input type="checkbox" id="decfatigue"><label for="decfatigue">Decision fatigue</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-emotional">Additional notes:</label>
                <textarea id="notes-emotional" placeholder="Any other thoughts about your emotional or mental state..."></textarea>
            </div>
        </div>
        
        <div class="category distortions">
            <h2>Cognitive Distortions</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="catastrophizing"><label for="catastrophizing">Catastrophizing</label></li>
                <li class="item"><input type="checkbox" id="mindreading"><label for="mindreading">Mind-reading</label></li>
                <li class="item"><input type="checkbox" id="blackwhite"><label for="blackwhite">Black-and-white thinking</label></li>
                <li class="item"><input type="checkbox" id="personalizing"><label for="personalizing">Personalizing</label></li>
                <li class="item"><input type="checkbox" id="emotreason"><label for="emotreason">Emotional reasoning</label></li>
                <li class="item"><input type="checkbox" id="jumping"><label for="jumping">Jumping to conclusions</label></li>
                <li class="item"><input type="checkbox" id="overgeneralizing"><label for="overgeneralizing">Overgeneralizing</label></li>
                <li class="item"><input type="checkbox" id="negative"><label for="negative">Focusing only on negative cues</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-distortions">Additional notes:</label>
                <textarea id="notes-distortions" placeholder="Any other cognitive patterns you noticed..."></textarea>
            </div>
        </div>
    </div>
    
    <div class="section-header">
        <h3>üîµ Psychosocial/External Factors</h3>
    </div>
    
    <div class="worksheet-container">
        <div class="category safety">
            <h2>Perceived Threats to Safety</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="physdanger"><label for="physdanger">Perception of physical danger</label></li>
                <li class="item"><input type="checkbox" id="psychunsafe"><label for="psychunsafe">Sense of psychological unsafety</label></li>
                <li class="item"><input type="checkbox" id="fearjudge"><label for="fearjudge">Fear of judgment or criticism</label></li>
                <li class="item"><input type="checkbox" id="fearreject"><label for="fearreject">Fear of rejection or abandonment</label></li>
                <li class="item"><input type="checkbox" id="misunderstood"><label for="misunderstood">Fear of being misunderstood</label></li>
                <li class="item"><input type="checkbox" id="anticipate"><label for="anticipate">Anticipation of conflict or confrontation</label></li>
                <li class="item"><input type="checkbox" id="pastneg"><label for="pastneg">Past negative experiences with this person</label></li>
                <li class="item"><input type="checkbox" id="power"><label for="power">Power imbalances (real or perceived)</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-safety">Additional notes:</label>
                <textarea id="notes-safety" placeholder="Any other safety concerns..."></textarea>
            </div>
        </div>
        
        <div class="category social">
            <h2>Social Context Pressures</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="timepressure"><label for="timepressure">Time pressure or sense of urgency</label></li>
                <li class="item"><input type="checkbox" id="audience"><label for="audience">Presence of audience or witnesses</label></li>
                <li class="item"><input type="checkbox" id="status"><label for="status">Status dynamics or hierarchy concerns</label></li>
                <li class="item"><input type="checkbox" id="cultural"><label for="cultural">Cultural or social role expectations</label></li>
                <li class="item"><input type="checkbox" id="competing"><label for="competing">Competing demands on attention</label></li>
                <li class="item"><input type="checkbox" id="interruptions"><label for="interruptions">Interruptions or lack of privacy</label></li>
                <li class="item"><input type="checkbox" id="technology"><label for="technology">Technology distractions (phone notifications)</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-social">Additional notes:</label>
                <textarea id="notes-social" placeholder="Any other social pressures..."></textarea>
            </div>
        </div>
        
        <div class="category relational">
            <h2>Relational Perceptions</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="rudeness"><label for="rudeness">Perceived rudeness or disrespect</label></li>
                <li class="item"><input type="checkbox" id="unheard"><label for="unheard">Feeling unheard or dismissed</label></li>
                <li class="item"><input type="checkbox" id="insincerity"><label for="insincerity">Sensing insincerity or manipulation</label></li>
                <li class="item"><input type="checkbox" id="incongruence"><label for="incongruence">Detecting incongruence (words vs. body language)</label></li>
                <li class="item"><input type="checkbox" id="blamed"><label for="blamed">Feeling blamed or accused</label></li>
                <li class="item"><input type="checkbox" id="unfairness"><label for="unfairness">Perceiving unfairness or injustice</label></li>
                <li class="item"><input type="checkbox" id="contempt"><label for="contempt">Sensing contempt or condescension</label></li>
                <li class="item"><input type="checkbox" id="patronized"><label for="patronized">Feeling patronized or infantilized</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-relational">Additional notes:</label>
                <textarea id="notes-relational" placeholder="Any other relational dynamics..."></textarea>
            </div>
        </div>
        
        <div class="category uncertainty">
            <h2>Uncertainty & Control</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="ambiguity"><label for="ambiguity">Ambiguity about expectations or rules</label></li>
                <li class="item"><input type="checkbox" id="unpredictability"><label for="unpredictability">Unpredictability in the interaction</label></li>
                <li class="item"><input type="checkbox" id="losscontrol"><label for="losscontrol">Loss of control or autonomy</label></li>
                <li class="item"><input type="checkbox" id="unclear"><label for="unclear">Unclear outcomes or stakes</label></li>
                <li class="item"><input type="checkbox" id="information"><label for="information">Information asymmetry</label></li>
                <li class="item"><input type="checkbox" id="confusion"><label for="confusion">Confusion about roles or responsibilities</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-uncertainty">Additional notes:</label>
                <textarea id="notes-uncertainty" placeholder="Any other uncertainties..."></textarea>
            </div>
        </div>
        
        <div class="category needs">
            <h2>Unmet Relational Needs</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="validation"><label for="validation">Need for acknowledgment or validation</label></li>
                <li class="item"><input type="checkbox" id="autonomy"><label for="autonomy">Need for autonomy or independence</label></li>
                <li class="item"><input type="checkbox" id="connection"><label for="connection">Need for connection or belonging</label></li>
                <li class="item"><input type="checkbox" id="competence"><label for="competence">Need for competence or effectiveness</label></li>
                <li class="item"><input type="checkbox" id="fairness"><label for="fairness">Need for fairness or equity</label></li>
                <li class="item"><input type="checkbox" id="meaning"><label for="meaning">Need for meaning or purpose</label></li>
                <li class="item"><input type="checkbox" id="predictability"><label for="predictability">Need for predictability or consistency</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-needs">Additional notes:</label>
                <textarea id="notes-needs" placeholder="Any other needs that were unmet..."></textarea>
            </div>
        </div>
    </div>
    
    <div class="section-header">
        <h3>üü£ Internal/External Intersection: Context & History</h3>
    </div>
    
    <div class="worksheet-container">
        <div class="category recent">
            <h2>Recent Activating Events</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="recentargument"><label for="recentargument">Recent argument or conflict</label></li>
                <li class="item"><input type="checkbox" id="disappointment"><label for="disappointment">Recent disappointment or letdown</label></li>
                <li class="item"><input type="checkbox" id="criticism"><label for="criticism">Recent criticism or negative feedback</label></li>
                <li class="item"><input type="checkbox" id="loss"><label for="loss">Recent loss or ending</label></li>
                <li class="item"><input type="checkbox" id="success"><label for="success">Recent success or failure</label></li>
                <li class="item"><input type="checkbox" id="comparison"><label for="comparison">Recent comparison to others</label></li>
                <li class="item"><input type="checkbox" id="reminder"><label for="reminder">Recent reminder of past wound</label></li>
                <li class="item"><input type="checkbox" id="recenttrauma"><label for="recenttrauma">Recent trauma, exploitation, or abuse</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-recent">Additional notes:</label>
                <textarea id="notes-recent" placeholder="Any other recent events that affected you..."></textarea>
            </div>
        </div>
        
        <div class="category identity">
            <h2>Identity, History & Meaning-Making</h2>
            <ul class="items">
                <li class="item"><input type="checkbox" id="pasttrauma"><label for="pasttrauma">Past trauma or old relational patterns activated</label></li>
                <li class="item"><input type="checkbox" id="attachment"><label for="attachment">Attachment fears triggered (abandonment, rejection, conflict)</label></li>
                <li class="item"><input type="checkbox" id="role"><label for="role">Falling into familiar role (caretaker, fixer, peacekeeper)</label></li>
                <li class="item"><input type="checkbox" id="beliefs"><label for="beliefs">Internalized beliefs surfacing ("I can't say no," "I'm too much," "I have to be perfect")</label></li>
                <li class="item"><input type="checkbox" id="culturalnorms"><label for="culturalnorms">Cultural norms or identity pressures influencing response</label></li>
                <li class="item"><input type="checkbox" id="values"><label for="values">Values or integrity feeling threatened</label></li>
                <li class="item"><input type="checkbox" id="discrimination"><label for="discrimination">Experiences of discrimination</label></li>
            </ul>
            <div class="category-notes">
                <label for="notes-identity">Additional notes:</label>
                <textarea id="notes-identity" placeholder="Any other patterns or historical factors..."></textarea>
            </div>
        </div>
    </div>
    
    <div class="integration">
        <h3>Integration & Insight</h3>
        
        <div class="integration-question">
            <label for="q1">1. What do I understand now about why I reacted the way I did?</label>
            <textarea id="q1" placeholder="Reflect on what factors from above might have contributed to your response..."></textarea>
        </div>
        
        <div class="integration-question">
            <label for="q2">2. What needs of mine were unmet in that moment?</label>
            <textarea id="q2" placeholder="Consider what you were needing that wasn't being addressed..."></textarea>
        </div>
        
        <div class="integration-question">
            <label for="q3">3. What would I have needed to stay more regulated?</label>
            <textarea id="q3" placeholder="Think about what would have helped you maintain balance..."></textarea>
        </div>
        
        <div class="integration-question">
            <label for="q4">4. What might I try differently next time?</label>
            <textarea id="q4" placeholder="Consider strategies or approaches you could use in the future..."></textarea>
        </div>
        
        <div class="integration-question">
            <label for="q5">5. Is repair necessary? Do I want to receive or give any apologies?</label>
            <textarea id="q5" placeholder="Reflect on whether the relationship needs repair and what that might look like..."></textarea>
        </div>
    </div>
    
    <div class="actions">
        <button class="btn btn-primary" onclick="saveWorksheet()">üíæ Save This Worksheet</button>
        <button class="btn btn-primary" onclick="window.print()">Print Worksheet</button>
        <button class="btn btn-primary" onclick="sendToTherapist()">üßê Send to my therapist</button>
        <button class="btn btn-secondary" onclick="clearAll()">Clear All</button>
    </div>
    
    <div class="save-options" id="saveOptions" style="display: none;">
        <button class="btn-save" onclick="saveAsNote()">üì± Save as Phone Note</button>
        <button class="btn-save" onclick="saveAsStickyNote()">üìù Save as Sticky Note</button>
        <button class="btn-save" onclick="saveAsTxt()">üìÑ Save as TXT File</button>
        <button class="btn-save" onclick="saveAsPDF()">üìï Save as PDF</button>
    </div>
    
    <div class="stats-dashboard">
        <h3>üìä Your Progress & Patterns</h3>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h4>Worksheets Completed</h4>
                <div class="stat-number" id="totalCompleted">0</div>
                <p style="margin: 0; color: #666; font-size: 0.9em;">Keep going! Patterns emerge over time.</p>
            </div>
            
            <div class="stat-card">
                <h4>Top 10 Most Common Factors</h4>
                <ul class="top-factors-list" id="topFactors">
                    <li style="color: #999; text-align: center;">Complete a worksheet to see patterns</li>
                </ul>
            </div>
            
            <div class="stat-card">
                <h4>Category Breakdown</h4>
                <div class="category-breakdown" id="categoryBreakdown">
                    <p style="color: #999; text-align: center; margin: 0;">Complete a worksheet to see category trends</p>
                </div>
            </div>
        </div>
        
        <div class="stat-card" style="margin-top: 20px;">
            <h4>Recent History (Last 10 Worksheets)</h4>
            <div class="history-list" id="historyList">
                <p style="color: #999; text-align: center; margin: 0;">Your completed worksheets will appear here</p>
            </div>
        </div>
        
        <div class="data-warning">
            <strong>‚ö†Ô∏è Important:</strong>
            Your data is stored locally in your browser. Clearing your browser cache or using a different browser/device will delete this data. Consider periodically saving your worksheets to keep a permanent record.
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        // Initialize stats on page load
        window.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
        });
        
        // Category mapping for breakdown
        const categoryMap = {
            'physiological': 'Basic Physical Needs',
            'nervous': 'Nervous System',
            'emotional': 'Emotional/Mental',
            'distortions': 'Cognitive Distortions',
            'safety': 'Safety Threats',
            'social': 'Social Pressures',
            'relational': 'Relational Perceptions',
            'uncertainty': 'Uncertainty & Control',
            'needs': 'Unmet Needs',
            'recent': 'Recent Events',
            'identity': 'Identity & History'
        };
        
        function getCategoryFromCheckbox(checkbox) {
            const categoryDiv = checkbox.closest('.category');
            const classes = categoryDiv.className.split(' ');
            for (let cls of classes) {
                if (cls !== 'category' && categoryMap[cls]) {
                    return cls;
                }
            }
            return 'other';
        }
        
        function saveWorksheet() {
            const saveOptions = document.getElementById('saveOptions');
            if (saveOptions.style.display === 'none') {
                saveOptions.style.display = 'flex';
            } else {
                saveOptions.style.display = 'none';
            }
        }
        
        function getCurrentWorksheetData() {
            const data = {
                date: new Date().toISOString(),
                context: document.getElementById('context').value,
                checkedItems: [],
                categoryNotes: {},
                integrationAnswers: {}
            };
            
            // Collect checked items
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                const label = document.querySelector(`label[for="${cb.id}"]`);
                const category = getCategoryFromCheckbox(cb);
                data.checkedItems.push({
                    id: cb.id,
                    text: label.textContent,
                    category: category
                });
            });
            
            // Collect category notes
            document.querySelectorAll('.category-notes textarea').forEach(ta => {
                if (ta.value) {
                    data.categoryNotes[ta.id] = ta.value;
                }
            });
            
            // Collect integration answers
            for (let i = 1; i <= 5; i++) {
                const answer = document.getElementById(`q${i}`).value;
                if (answer) {
                    data.integrationAnswers[`q${i}`] = answer;
                }
            }
            
            return data;
        }
        
        function saveWorksheetToHistory() {
            const data = getCurrentWorksheetData();
            
            // Get existing history
            let history = JSON.parse(localStorage.getItem('worksheetHistory') || '[]');
            history.unshift(data);
            
            // Keep only last 50
            if (history.length > 50) {
                history = history.slice(0, 50);
            }
            
            localStorage.setItem('worksheetHistory', JSON.stringify(history));
            
            // Update checkbox counts
            let counts = JSON.parse(localStorage.getItem('checkboxCounts') || '{}');
            data.checkedItems.forEach(item => {
                counts[item.id] = (counts[item.id] || 0) + 1;
            });
            localStorage.setItem('checkboxCounts', JSON.stringify(counts));
            
            // Update category counts
            let categoryCounts = JSON.parse(localStorage.getItem('categoryCounts') || '{}');
            data.checkedItems.forEach(item => {
                categoryCounts[item.category] = (categoryCounts[item.category] || 0) + 1;
            });
            localStorage.setItem('categoryCounts', JSON.stringify(categoryCounts));
            
            updateDashboard();
        }
        
        function updateDashboard() {
            const history = JSON.parse(localStorage.getItem('worksheetHistory') || '[]');
            const counts = JSON.parse(localStorage.getItem('checkboxCounts') || '{}');
            const categoryCounts = JSON.parse(localStorage.getItem('categoryCounts') || '{}');
            
            // Update total completed
            document.getElementById('totalCompleted').textContent = history.length;
            
            // Update top factors
            const topFactorsList = document.getElementById('topFactors');
            const sortedFactors = Object.entries(counts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            if (sortedFactors.length > 0) {
                topFactorsList.innerHTML = sortedFactors.map(([id, count]) => {
                    const label = document.querySelector(`label[for="${id}"]`);
                    const text = label ? label.textContent : id;
                    return `<li><span>${text}</span><span class="factor-count">${count}</span></li>`;
                }).join('');
            } else {
                topFactorsList.innerHTML = '<li style="color: #999; text-align: center;">Complete a worksheet to see patterns</li>';
            }
            
            // Update category breakdown
            const categoryBreakdown = document.getElementById('categoryBreakdown');
            const totalChecks = Object.values(categoryCounts).reduce((a, b) => a + b, 0);
            
            if (totalChecks > 0) {
                const sortedCategories = Object.entries(categoryCounts)
                    .sort((a, b) => b[1] - a[1]);
                
                categoryBreakdown.innerHTML = sortedCategories.map(([cat, count]) => {
                    const percentage = Math.round((count / totalChecks) * 100);
                    return `
                        <div class="category-bar">
                            <div class="category-label">${categoryMap[cat] || cat}</div>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: ${percentage}%">
                                    <span class="bar-percentage">${percentage}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                categoryBreakdown.innerHTML = '<p style="color: #999; text-align: center; margin: 0;">Complete a worksheet to see category trends</p>';
            }
            
            // Update history list
            const historyList = document.getElementById('historyList');
            if (history.length > 0) {
                historyList.innerHTML = history.slice(0, 10).map((item, idx) => {
                    const date = new Date(item.date).toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    const summary = item.context ? item.context.substring(0, 60) + '...' : 'No description';
                    return `
                        <div class="history-item" onclick="loadWorksheet(${idx})">
                            <div class="history-date">${date}</div>
                            <div class="history-summary">${summary}</div>
                            <div class="history-summary">${item.checkedItems.length} factors identified</div>
                        </div>
                    `;
                }).join('');
            } else {
                historyList.innerHTML = '<p style="color: #999; text-align: center; margin: 0;">Your completed worksheets will appear here</p>';
            }
        }
        
        function loadWorksheet(index) {
            if (!confirm('Load this previous worksheet? Your current work will be cleared.')) {
                return;
            }
            
            const history = JSON.parse(localStorage.getItem('worksheetHistory') || '[]');
            const data = history[index];
            
            // Clear current
            clearAll(true);
            
            // Load data
            document.getElementById('context').value = data.context || '';
            
            data.checkedItems.forEach(item => {
                const checkbox = document.getElementById(item.id);
                if (checkbox) checkbox.checked = true;
            });
            
            Object.entries(data.categoryNotes || {}).forEach(([id, value]) => {
                const textarea = document.getElementById(id);
                if (textarea) textarea.value = value;
            });
            
            Object.entries(data.integrationAnswers || {}).forEach(([id, value]) => {
                const textarea = document.getElementById(id);
                if (textarea) textarea.value = value;
            });
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function generateWorksheetText() {
            const data = getCurrentWorksheetData();
            const date = new Date(data.date).toLocaleDateString('en-US', { 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let text = `SELF-COMPASSION CONFLICT WORKSHEET\n`;
            text += `Completed: ${date}\n`;
            text += `${'='.repeat(50)}\n\n`;
            
            if (data.context) {
                text += `WHAT HAPPENED:\n${data.context}\n\n`;
            }
            
            if (data.checkedItems.length > 0) {
                text += `FACTORS IDENTIFIED:\n`;
                const groupedByCategory = {};
                data.checkedItems.forEach(item => {
                    if (!groupedByCategory[item.category]) {
                        groupedByCategory[item.category] = [];
                    }
                    groupedByCategory[item.category].push(item.text);
                });
                
                Object.entries(groupedByCategory).forEach(([cat, items]) => {
                    text += `\n${categoryMap[cat] || cat}:\n`;
                    items.forEach(item => {
                        text += `  ‚Ä¢ ${item}\n`;
                    });
                });
                text += `\n`;
            }
            
            if (Object.keys(data.categoryNotes).length > 0) {
                text += `ADDITIONAL NOTES:\n`;
                Object.entries(data.categoryNotes).forEach(([id, value]) => {
                    const category = id.replace('notes-', '');
                    text += `\n${categoryMap[category] || category}:\n${value}\n`;
                });
                text += `\n`;
            }
            
            const questions = [
                'What do I understand now about why I reacted the way I did?',
                'What needs of mine were unmet in that moment?',
                'What would I have needed to stay more regulated?',
                'What might I try differently next time?',
                'Is repair necessary? Do I want to receive or give any apologies?'
            ];
            
            let hasAnswers = false;
            let answersText = '';
            Object.entries(data.integrationAnswers).forEach(([id, value]) => {
                const qNum = parseInt(id.replace('q', '')) - 1;
                hasAnswers = true;
                answersText += `\n${qNum + 1}. ${questions[qNum]}\n${value}\n`;
            });
            
            if (hasAnswers) {
                text += `INTEGRATION & INSIGHT:${answersText}\n`;
            }
            
            text += `\n${'='.repeat(50)}\n`;
            text += `More tools: @instageorgious\n`;
            
            return text;
        }
        
        function saveAsNote() {
            const text = generateWorksheetText();
            saveWorksheetToHistory();
            
            // Copy to clipboard
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Worksheet copied to clipboard! Paste it into your phone notes app.');
            }).catch(() => {
                alert('Unable to copy automatically. Please use the TXT option instead.');
            });
        }
        
        function saveAsStickyNote() {
            const text = generateWorksheetText();
            saveWorksheetToHistory();
            
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Worksheet copied to clipboard! Create a new sticky note and paste.');
            }).catch(() => {
                alert('Unable to copy automatically. Please use the TXT option instead.');
            });
        }
        
        function saveAsTxt() {
            const text = generateWorksheetText();
            saveWorksheetToHistory();
            
            const blob = new Blob([text], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Conflict_Worksheet_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
        }
        
        async function saveAsPDF() {
            saveWorksheetToHistory();
            await sendToTherapist();
        }
        
        function clearAll(skipConfirm = false) {
            if (!skipConfirm && !confirm('Are you sure you want to clear all your responses? This cannot be undone.')) {
                return;
            }
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('textarea').forEach(ta => ta.value = '');
        }
        
        async function sendToTherapist() {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Generating PDF...';
            button.disabled = true;
            
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 15;
                let yPos = margin;
                
                // Title
                pdf.setFontSize(18);
                pdf.setFont(undefined, 'bold');
                pdf.text('Self-Compassion Conflict Worksheet', pageWidth / 2, yPos, { align: 'center' });
                yPos += 10;
                
                // Date
                pdf.setFontSize(10);
                pdf.setFont(undefined, 'normal');
                const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                pdf.text(`Completed: ${date}`, pageWidth / 2, yPos, { align: 'center' });
                yPos += 12;
                
                // Context
                const context = document.getElementById('context').value;
                if (context) {
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('What happened?', margin, yPos);
                    yPos += 7;
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, 'normal');
                    const contextLines = pdf.splitTextToSize(context, pageWidth - 2 * margin);
                    pdf.text(contextLines, margin, yPos);
                    yPos += contextLines.length * 5 + 8;
                }
                
                // Checked items
                const checkedItems = [];
                document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                    const label = document.querySelector(`label[for="${cb.id}"]`);
                    const category = cb.closest('.category').querySelector('h2').textContent;
                    checkedItems.push({ category, text: label.textContent });
                });
                
                if (checkedItems.length > 0) {
                    if (yPos > pageHeight - 40) {
                        pdf.addPage();
                        yPos = margin;
                    }
                    
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Factors Identified:', margin, yPos);
                    yPos += 7;
                    
                    let currentCategory = '';
                    checkedItems.forEach(item => {
                        if (yPos > pageHeight - 20) {
                            pdf.addPage();
                            yPos = margin;
                        }
                        
                        if (item.category !== currentCategory) {
                            pdf.setFontSize(11);
                            pdf.setFont(undefined, 'bold');
                            pdf.text(item.category, margin + 2, yPos);
                            yPos += 6;
                            currentCategory = item.category;
                        }
                        
                        pdf.setFontSize(10);
                        pdf.setFont(undefined, 'normal');
                        pdf.text('‚Ä¢ ' + item.text, margin + 5, yPos);
                        yPos += 5;
                    });
                    yPos += 5;
                }
                
                // Collect notes from category sections
                const categoryNotes = [];
                document.querySelectorAll('.category-notes textarea').forEach(ta => {
                    if (ta.value) {
                        const category = ta.closest('.category').querySelector('h2').textContent;
                        categoryNotes.push({ category, notes: ta.value });
                    }
                });
                
                if (categoryNotes.length > 0) {
                    if (yPos > pageHeight - 40) {
                        pdf.addPage();
                        yPos = margin;
                    }
                    
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Additional Category Notes:', margin, yPos);
                    yPos += 7;
                    
                    categoryNotes.forEach(item => {
                        if (yPos > pageHeight - 30) {
                            pdf.addPage();
                            yPos = margin;
                        }
                        
                        pdf.setFontSize(11);
                        pdf.setFont(undefined, 'bold');
                        pdf.text(item.category, margin + 2, yPos);
                        yPos += 6;
                        
                        pdf.setFontSize(10);
                        pdf.setFont(undefined, 'normal');
                        const notesLines = pdf.splitTextToSize(item.notes, pageWidth - 2 * margin - 5);
                        pdf.text(notesLines, margin + 5, yPos);
                        yPos += notesLines.length * 5 + 6;
                    });
                    yPos += 5;
                }
                
                // Integration questions
                const questions = [
                    { id: 'q1', label: 'What do I understand now about why I reacted the way I did?' },
                    { id: 'q2', label: 'What needs of mine were unmet in that moment?' },
                    { id: 'q3', label: 'What would I have needed to stay more regulated?' },
                    { id: 'q4', label: 'What might I try differently next time?' },
                    { id: 'q5', label: 'Is repair necessary? Do I want to receive or give any apologies?' }
                ];
                
                questions.forEach((q, idx) => {
                    const answer = document.getElementById(q.id).value;
                    if (answer) {
                        if (yPos > pageHeight - 40) {
                            pdf.addPage();
                            yPos = margin;
                        }
                        
                        pdf.setFontSize(11);
                        pdf.setFont(undefined, 'bold');
                        pdf.text(`${idx + 1}. ${q.label}`, margin, yPos);
                        yPos += 7;
                        
                        pdf.setFontSize(10);
                        pdf.setFont(undefined, 'normal');
                        const answerLines = pdf.splitTextToSize(answer, pageWidth - 2 * margin);
                        pdf.text(answerLines, margin, yPos);
                        yPos += answerLines.length * 5 + 8;
                    }
                });
                
                // Generate PDF as blob
                const pdfBlob = pdf.output('blob');
                const pdfDataUrl = await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(pdfBlob);
                });
                
                // Create email with attachment
                const subject = encodeURIComponent('Self-Compassion Conflict Worksheet');
                const body = encodeURIComponent('Hi,\n\nI\'ve attached my completed Self-Compassion Conflict Worksheet for review.\n\nBest regards');
                
                // Note: Direct attachment via mailto is not supported by browsers
                // Instead, we'll download the PDF and inform the user
                const link = document.createElement('a');
                link.href = URL.createObjectURL(pdfBlob);
                link.download = `Conflict_Worksheet_${new Date().toISOString().split('T')[0]}.pdf`;
                link.click();
                
                // Open email client
                setTimeout(() => {
                    window.location.href = `mailto:?subject=${subject}&body=${body}`;
                }, 500);
                
                alert('PDF downloaded! Please attach it to the email that just opened.');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('There was an error generating the PDF. Please try using the Print button instead.');
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }
    </script>
</body>
</html>
